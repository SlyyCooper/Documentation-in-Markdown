You are a senior software developer but yet you are the most genius developer in the world knowing efficient code and how to structure things in such a unique way that people are awed you are currently handling this anthropic open ai multi-agent system using the brand new anthropic model 'claude-3-5-sonnet-20241022' and **ONLY** the 'claude-3-5-sonnet-20241022' model!!

As you can see the below repositories contain different examples and implementations of common agent and multi-agent workflows. The documentation you must create Must contain steps that are general on just how to create the multi-agent systems with this anthropic documentation and on the specified model that I already stated. And only that model. You are to completely forget your knowledge base and take this as a contract in the Bible. As this code base is complete and accurate based on the latest documentation. So even if you come across something that you believe contradicts your knowledge you are to assume that your knowledge is incorrect, and the below code base is correct as this is the latest documentation that is past your knowledge cutoff thus your knowledge is deprecated. Thus, forget everything in your knowledge. This is literally the best, most intelligent, up-to-date documentation code base there is. That's why you have the latest documentation in all tools. You need to create a complete and accurate step-by-step, easy to understand yet comprehensive and all inclusive guide not missing one step for the world to have from the most complex intelligent developer, who wants to do something amazing complex with it to somebody who's doing a no code. Who's like just starting literally have the range go so wide and create this and make it be complete and accurate yep all the documentation you need below so provide it to me in a nice format covering each topic and do not include any pseudo code any place holders or any examples. Examples or any non-functional code it should actually be chat bot functional the users will have their anthropic API key already in their dot nv or exported in their environment, so they will be ready to go on that end you'll have to use an environment variable or just have it be ready to take from the exported API key but always use the 'claude-3-5-sonnet-20241022' and **ONLY** the 'claude-3-5-sonnet-20241022' model!! 

NOTE: The Jupyter Notebook and code base I have provided below will only be provided to you and will not be provided to anybody else. It will be destroyed after you created this in-depth documentation. Thus do not refer to these files in your the documentation you create. That is why it is so crucial for you to create complete, accurate, all-inclusive, and in-depth documentation! 

# Anthropic Agent & Multi-Agent Repositories 
.
└── patterns
    └── agents
        ├── README.md
        ├── basic_workflows.ipynb
        ├── evaluator_optimizer.ipynb
        ├── orchestrator_workers.ipynb
        └── util.py


/patterns/agents/README.md:
--------------------------------------------------------------------------------
 1 | # Building Effective Agents Cookbook
 2 | 
 3 | Reference implementation for [Building Effective Agents](https://anthropic.com/research/building-effective-agents) by Erik Schluntz and Barry Zhang.
 4 | 
 5 | This repository contains example minimal implementations of common agent workflows discussed in the blog:
 6 | 
 7 | - Basic Building Blocks
 8 |   - Prompt Chaining
 9 |   - Routing
10 |   - Multi-LLM Parallelization
11 | - Advanced Workflows
12 |   - Orchestrator-Subagents
13 |   - Evaluator-Optimizer
14 | 
15 | ## Getting Started
16 | See the Jupyter notebooks for detailed examples:
17 | 
18 | - [Basic Workflows](basic_workflows.ipynb)
19 | - [Evaluator-Optimizer Workflow](evaluator_optimizer.ipynb) 
20 | - [Orchestrator-Workers Workflow](orchestrator_workers.ipynb)


--------------------------------------------------------------------------------
/patterns/agents/basic_workflows.ipynb:
--------------------------------------------------------------------------------
  1 | {
  2 |  "cells": [
  3 |   {
  4 |    "cell_type": "markdown",
  5 |    "metadata": {},
  6 |    "source": [
  7 |     "## Basic Multi-LLM Workflows\n",
  8 |     "\n",
  9 |     "This notebook demonstrates three simple multi-LLM workflows. They trade off cost or latency for potentially improved task performances:\n",
 10 |     "\n",
 11 |     "1. **Prompt-Chaining**: Decomposes a task into sequential subtasks, where each step builds on previous results\n",
 12 |     "2. **Parallelization**: Distributes independent subtasks across multiple LLMs for concurrent processing\n",
 13 |     "3. **Routing**: Dynamically selects specialized LLM paths based on input characteristics\n",
 14 |     "\n",
 15 |     "Note: These are sample implementations meant to demonstrate core concepts - not production code."
 16 |    ]
 17 |   },
 18 |   {
 19 |    "cell_type": "code",
 20 |    "execution_count": null,
 21 |    "metadata": {},
 22 |    "outputs": [],
 23 |    "source": [
 24 |     "from concurrent.futures import ThreadPoolExecutor\n",
 25 |     "from typing import List, Dict, Callable\n",
 26 |     "from util import llm_call, extract_xml"
 27 |    ]
 28 |   },
 29 |   {
 30 |    "cell_type": "code",
 31 |    "execution_count": 3,
 32 |    "metadata": {},
 33 |    "outputs": [],
 34 |    "source": [
 35 |     "def chain(input: str, prompts: List[str]) -> str:\n",
 36 |     "    \"\"\"Chain multiple LLM calls sequentially, passing results between steps.\"\"\"\n",
 37 |     "    result = input\n",
 38 |     "    for i, prompt in enumerate(prompts, 1):\n",
 39 |     "        print(f\"\\nStep {i}:\")\n",
 40 |     "        result = llm_call(f\"{prompt}\\nInput: {result}\")\n",
 41 |     "        print(result)\n",
 42 |     "    return result\n",
 43 |     "\n",
 44 |     "def parallel(prompt: str, inputs: List[str], n_workers: int = 3) -> List[str]:\n",
 45 |     "    \"\"\"Process multiple inputs concurrently with the same prompt.\"\"\"\n",
 46 |     "    with ThreadPoolExecutor(max_workers=n_workers) as executor:\n",
 47 |     "        futures = [executor.submit(llm_call, f\"{prompt}\\nInput: {x}\") for x in inputs]\n",
 48 |     "        return [f.result() for f in futures]\n",
 49 |     "\n",
 50 |     "def route(input: str, routes: Dict[str, str]) -> str:\n",
 51 |     "    \"\"\"Route input to specialized prompt using content classification.\"\"\"\n",
 52 |     "    # First determine appropriate route using LLM with chain-of-thought\n",
 53 |     "    print(f\"\\nAvailable routes: {list(routes.keys())}\")\n",
 54 |     "    selector_prompt = f\"\"\"\n",
 55 |     "    Analyze the input and select the most appropriate support team from these options: {list(routes.keys())}\n",
 56 |     "    First explain your reasoning, then provide your selection in this XML format:\n",
 57 |     "\n",
 58 |     "    <reasoning>\n",
 59 |     "    Brief explanation of why this ticket should be routed to a specific team.\n",
 60 |     "    Consider key terms, user intent, and urgency level.\n",
 61 |     "    </reasoning>\n",
 62 |     "\n",
 63 |     "    <selection>\n",
 64 |     "    The chosen team name\n",
 65 |     "    </selection>\n",
 66 |     "\n",
 67 |     "    Input: {input}\"\"\".strip()\n",
 68 |     "    \n",
 69 |     "    route_response = llm_call(selector_prompt)\n",
 70 |     "    reasoning = extract_xml(route_response, 'reasoning')\n",
 71 |     "    route_key = extract_xml(route_response, 'selection').strip().lower()\n",
 72 |     "    \n",
 73 |     "    print(\"Routing Analysis:\")\n",
 74 |     "    print(reasoning)\n",
 75 |     "    print(f\"\\nSelected route: {route_key}\")\n",
 76 |     "    \n",
 77 |     "    # Process input with selected specialized prompt\n",
 78 |     "    selected_prompt = routes[route_key]\n",
 79 |     "    return llm_call(f\"{selected_prompt}\\nInput: {input}\")"
 80 |    ]
 81 |   },
 82 |   {
 83 |    "cell_type": "markdown",
 84 |    "metadata": {},
 85 |    "source": [
 86 |     "## Example Usage\n",
 87 |     "\n",
 88 |     "Below are practical examples demonstrating each workflow:\n",
 89 |     "1. Chain workflow for structured data extraction and formatting\n",
 90 |     "2. Parallelization workflow for stakeholder impact analysis\n",
 91 |     "3. Route workflow for customer support ticket handling"
 92 |    ]
 93 |   },
 94 |   {
 95 |    "cell_type": "code",
 96 |    "execution_count": 4,
 97 |    "metadata": {},
 98 |    "outputs": [
 99 |     {
100 |      "name": "stdout",
101 |      "output_type": "stream",
102 |      "text": [
103 |       "\n",
104 |       "Input text:\n",
105 |       "\n",
106 |       "Q3 Performance Summary:\n",
107 |       "Our customer satisfaction score rose to 92 points this quarter.\n",
108 |       "Revenue grew by 45% compared to last year.\n",
109 |       "Market share is now at 23% in our primary market.\n",
110 |       "Customer churn decreased to 5% from 8%.\n",
111 |       "New user acquisition cost is $43 per user.\n",
112 |       "Product adoption rate increased to 78%.\n",
113 |       "Employee satisfaction is at 87 points.\n",
114 |       "Operating margin improved to 34%.\n",
115 |       "\n",
116 |       "\n",
117 |       "Step 1:\n",
118 |       "92: customer satisfaction points\n",
119 |       "45%: revenue growth\n",
120 |       "23%: market share\n",
121 |       "5%: customer churn\n",
122 |       "8%: previous customer churn\n",
123 |       "$43: user acquisition cost\n",
124 |       "78%: product adoption rate\n",
125 |       "87: employee satisfaction points\n",
126 |       "34%: operating margin\n",
127 |       "\n",
128 |       "Step 2:\n",
129 |       "92%: customer satisfaction\n",
130 |       "45%: revenue growth\n",
131 |       "23%: market share\n",
132 |       "5%: customer churn\n",
133 |       "8%: previous customer churn\n",
134 |       "43.00: user acquisition cost\n",
135 |       "78%: product adoption rate\n",
136 |       "87%: employee satisfaction\n",
137 |       "34%: operating margin\n",
138 |       "\n",
139 |       "Step 3:\n",
140 |       "Here are the lines sorted in descending order by numerical value:\n",
141 |       "\n",
142 |       "92%: customer satisfaction\n",
143 |       "87%: employee satisfaction\n",
144 |       "78%: product adoption rate\n",
145 |       "45%: revenue growth\n",
146 |       "43.00: user acquisition cost\n",
147 |       "34%: operating margin\n",
148 |       "23%: market share\n",
149 |       "8%: previous customer churn\n",
150 |       "5%: customer churn\n",
151 |       "\n",
152 |       "Step 4:\n",
153 |       "| Metric | Value |\n",
154 |       "|:--|--:|\n",
155 |       "| Customer Satisfaction | 92% |\n",
156 |       "| Employee Satisfaction | 87% |\n",
157 |       "| Product Adoption Rate | 78% |\n",
158 |       "| Revenue Growth | 45% |\n",
159 |       "| User Acquisition Cost | 43.00 |\n",
160 |       "| Operating Margin | 34% |\n",
161 |       "| Market Share | 23% |\n",
162 |       "| Previous Customer Churn | 8% |\n",
163 |       "| Customer Churn | 5% |\n",
164 |       "| Metric | Value |\n",
165 |       "|:--|--:|\n",
166 |       "| Customer Satisfaction | 92% |\n",
167 |       "| Employee Satisfaction | 87% |\n",
168 |       "| Product Adoption Rate | 78% |\n",
169 |       "| Revenue Growth | 45% |\n",
170 |       "| User Acquisition Cost | 43.00 |\n",
171 |       "| Operating Margin | 34% |\n",
172 |       "| Market Share | 23% |\n",
173 |       "| Previous Customer Churn | 8% |\n",
174 |       "| Customer Churn | 5% |\n"
175 |      ]
176 |     }
177 |    ],
178 |    "source": [
179 |     "# Example 1: Chain workflow for structured data extraction and formatting\n",
180 |     "# Each step progressively transforms raw text into a formatted table\n",
181 |     "\n",
182 |     "data_processing_steps = [\n",
183 |     "    \"\"\"Extract only the numerical values and their associated metrics from the text.\n",
184 |     "    Format each as 'value: metric' on a new line.\n",
185 |     "    Example format:\n",
186 |     "    92: customer satisfaction\n",
187 |     "    45%: revenue growth\"\"\",\n",
188 |     "    \n",
189 |     "    \"\"\"Convert all numerical values to percentages where possible.\n",
190 |     "    If not a percentage or points, convert to decimal (e.g., 92 points -> 92%).\n",
191 |     "    Keep one number per line.\n",
192 |     "    Example format:\n",
193 |     "    92%: customer satisfaction\n",
194 |     "    45%: revenue growth\"\"\",\n",
195 |     "    \n",
196 |     "    \"\"\"Sort all lines in descending order by numerical value.\n",
197 |     "    Keep the format 'value: metric' on each line.\n",
198 |     "    Example:\n",
199 |     "    92%: customer satisfaction\n",
200 |     "    87%: employee satisfaction\"\"\",\n",
201 |     "    \n",
202 |     "    \"\"\"Format the sorted data as a markdown table with columns:\n",
203 |     "    | Metric | Value |\n",
204 |     "    |:--|--:|\n",
205 |     "    | Customer Satisfaction | 92% |\"\"\"\n",
206 |     "]\n",
207 |     "\n",
208 |     "report = \"\"\"\n",
209 |     "Q3 Performance Summary:\n",
210 |     "Our customer satisfaction score rose to 92 points this quarter.\n",
211 |     "Revenue grew by 45% compared to last year.\n",
212 |     "Market share is now at 23% in our primary market.\n",
213 |     "Customer churn decreased to 5% from 8%.\n",
214 |     "New user acquisition cost is $43 per user.\n",
215 |     "Product adoption rate increased to 78%.\n",
216 |     "Employee satisfaction is at 87 points.\n",
217 |     "Operating margin improved to 34%.\n",
218 |     "\"\"\"\n",
219 |     "\n",
220 |     "print(\"\\nInput text:\")\n",
221 |     "print(report)\n",
222 |     "formatted_result = chain(report, data_processing_steps)\n",
223 |     "print(formatted_result)"
224 |    ]
225 |   },
226 |   {
227 |    "cell_type": "code",
228 |    "execution_count": 5,
229 |    "metadata": {},
230 |    "outputs": [
231 |     {
232 |      "name": "stdout",
233 |      "output_type": "stream",
234 |      "text": [
235 |       "MARKET IMPACT ANALYSIS FOR CUSTOMERS\n",
236 |       "============================================\n",
237 |       "\n",
238 |       "HIGH PRIORITY IMPACTS\n",
239 |       "--------------------\n",
240 |       "1. Price Sensitivity\n",
241 |       "- Rising inflation and costs likely to reduce purchasing power\n",
242 |       "- Increased competition for value-oriented products\n",
243 |       "- Risk of customers trading down to lower-cost alternatives\n",
244 |       "\n",
245 |       "Recommended Actions:\n",
246 |       "• Introduce tiered pricing options\n",
247 |       "• Develop value-focused product lines\n",
248 |       "• Implement loyalty programs with cost-saving benefits\n",
249 |       "• Highlight total cost of ownership benefits\n",
250 |       "\n",
251 |       "2. Technology Demands\n",
252 |       "- Accelerating tech advancement creating higher expectations\n",
253 |       "- Growing demand for smart/connected features\n",
254 |       "- Integration with mobile devices and apps becoming standard\n",
255 |       "\n",
256 |       "Recommended Actions:\n",
257 |       "• Accelerate digital transformation initiatives\n",
258 |       "• Invest in user experience improvements\n",
259 |       "• Develop smart product features\n",
260 |       "• Create technology roadmap aligned with customer needs\n",
261 |       "\n",
262 |       "MEDIUM PRIORITY IMPACTS\n",
263 |       "----------------------\n",
264 |       "3. Environmental Consciousness\n",
265 |       "- Growing demand for sustainable products\n",
266 |       "- Increased scrutiny of environmental practices\n",
267 |       "- Willingness to pay premium for eco-friendly options\n",
268 |       "\n",
269 |       "Recommended Actions:\n",
270 |       "• Develop eco-friendly product lines\n",
271 |       "• Improve sustainability messaging\n",
272 |       "• Create transparent environmental reporting\n",
273 |       "• Consider green certification programs\n",
274 |       "\n",
275 |       "MONITORING & IMPLEMENTATION\n",
276 |       "--------------------------\n",
277 |       "1. Track customer satisfaction metrics\n",
278 |       "2. Conduct regular market surveys\n",
279 |       "3. Monitor competitor responses\n",
280 |       "4. Review pricing strategies quarterly\n",
281 |       "5. Measure environmental impact improvements\n",
282 |       "\n",
283 |       "SUCCESS METRICS\n",
284 |       "--------------\n",
285 |       "• Customer retention rates\n",
286 |       "• Market share\n",
287 |       "• Sustainability goals met\n",
288 |       "• Customer satisfaction scores\n",
289 |       "• Technology adoption rates\n",
290 |       "\n",
291 |       "This analysis should be reviewed quarterly and adjusted based on market conditions and customer feedback.\n",
292 |       "MARKET IMPACT ANALYSIS FOR EMPLOYEES\n",
293 |       "\n",
294 |       "Priority 1: Job Security Concerns\n",
295 |       "Impacts:\n",
296 |       "• Market volatility creating uncertainty about positions\n",
297 |       "• Potential restructuring or role changes\n",
298 |       "• Stress affecting productivity and morale\n",
299 |       "\n",
300 |       "Recommended Actions:\n",
301 |       "- Provide regular, transparent communications about company stability\n",
302 |       "- Create clear retention plans for key talent\n",
303 |       "- Establish severance/transition support programs if needed\n",
304 |       "- Develop internal mobility programs\n",
305 |       "\n",
306 |       "Priority 2: Skills Gap & Development\n",
307 |       "Impacts:\n",
308 |       "• Current skills becoming outdated due to market changes\n",
309 |       "• New technologies/processes requiring different capabilities\n",
310 |       "• Competition for skilled workers increasing\n",
311 |       "\n",
312 |       "Recommended Actions:\n",
313 |       "- Conduct skills gap analysis\n",
314 |       "- Implement targeted training programs\n",
315 |       "- Offer tuition reimbursement/certification support\n",
316 |       "- Create mentorship programs\n",
317 |       "- Partner with educational institutions\n",
318 |       "\n",
319 |       "Priority 3: Strategic Direction & Leadership\n",
320 |       "Impacts:\n",
321 |       "• Unclear career paths in changing environment\n",
322 |       "• Uncertainty about future company direction\n",
323 |       "• Need for new leadership approaches\n",
324 |       "\n",
325 |       "Recommended Actions:\n",
326 |       "- Develop and communicate clear strategic roadmap\n",
327 |       "- Create detailed career progression frameworks\n",
328 |       "- Increase leadership visibility and accessibility\n",
329 |       "- Establish regular town halls/feedback sessions\n",
330 |       "- Implement change management programs\n",
331 |       "\n",
332 |       "Implementation Timeline:\n",
333 |       "Short-term (0-3 months):\n",
334 |       "- Begin communication initiatives\n",
335 |       "- Start skills assessment\n",
336 |       "- Launch feedback channels\n",
337 |       "\n",
338 |       "Medium-term (3-12 months):\n",
339 |       "- Roll out training programs\n",
340 |       "- Implement career frameworks\n",
341 |       "- Develop retention strategies\n",
342 |       "\n",
343 |       "Long-term (12+ months):\n",
344 |       "- Build sustainable talent development\n",
345 |       "- Create lasting cultural changes\n",
346 |       "- Monitor and adjust programs\n",
347 |       "\n",
348 |       "Success Metrics:\n",
349 |       "• Employee retention rates\n",
350 |       "• Skills acquisition levels\n",
351 |       "• Employee satisfaction scores\n",
352 |       "• Internal promotion rates\n",
353 |       "• Productivity measures\n",
354 |       "MARKET IMPACT ANALYSIS FOR INVESTORS\n",
355 |       "===============================\n",
356 |       "\n",
357 |       "Primary Impacts\n",
358 |       "--------------\n",
359 |       "1. Growth Expectations\n",
360 |       "- Market volatility may reduce short-term returns\n",
361 |       "- Potential slowdown in expansion opportunities\n",
362 |       "- Competition for investment capital increasing\n",
363 |       "\n",
364 |       "2. Cost Control Concerns  \n",
365 |       "- Rising operational costs due to inflation\n",
366 |       "- Supply chain disruptions affecting margins\n",
367 |       "- Higher borrowing costs from interest rates\n",
368 |       "\n",
369 |       "3. Risk Profile\n",
370 |       "- Increased market uncertainty\n",
371 |       "- Regulatory changes creating compliance costs\n",
372 |       "- Geopolitical tensions affecting global investments\n",
373 |       "\n",
374 |       "Recommended Actions (Prioritized)\n",
375 |       "-------------------------------\n",
376 |       "Immediate Priority:\n",
377 |       "1. Strengthen risk management protocols\n",
378 |       "- Implement enhanced monitoring systems\n",
379 |       "- Diversify investment portfolio\n",
380 |       "- Develop contingency plans for market shifts\n",
381 |       "\n",
382 |       "Medium Priority:\n",
383 |       "2. Optimize cost structure\n",
384 |       "- Review operational efficiency\n",
385 |       "- Identify automation opportunities\n",
386 |       "- Renegotiate supplier contracts\n",
387 |       "\n",
388 |       "3. Enhance communication\n",
389 |       "- Increase transparency in reporting\n",
390 |       "- Regular stakeholder updates\n",
391 |       "- Clear messaging on strategy adjustments\n",
392 |       "\n",
393 |       "Long-term Priority:\n",
394 |       "4. Strategic repositioning\n",
395 |       "- Explore new growth markets\n",
396 |       "- Invest in innovation\n",
397 |       "- Build resilience through diversification\n",
398 |       "\n",
399 |       "Key Performance Metrics to Monitor\n",
400 |       "--------------------------------\n",
401 |       "1. Return on Investment (ROI)\n",
402 |       "2. Cost-to-Income Ratio\n",
403 |       "3. Risk-adjusted returns\n",
404 |       "4. Market share growth\n",
405 |       "5. Operating margins\n",
406 |       "\n",
407 |       "Success Criteria\n",
408 |       "---------------\n",
409 |       "- Maintained or improved ROI\n",
410 |       "- Effective cost management\n",
411 |       "- Risk levels within acceptable parameters\n",
412 |       "- Clear communication with stakeholders\n",
413 |       "- Strategic objectives met\n",
414 |       "MARKET IMPACT ANALYSIS FOR SUPPLIERS\n",
415 |       "\n",
416 |       "Priority 1: Capacity Constraints\n",
417 |       "Impacts:\n",
418 |       "• Reduced ability to meet customer demand\n",
419 |       "• Risk of losing market share to competitors\n",
420 |       "• Increased operational costs from running at maximum capacity\n",
421 |       "\n",
422 |       "Recommended Actions:\n",
423 |       "- Invest in capacity expansion where financially viable\n",
424 |       "- Implement advanced scheduling and forecasting systems\n",
425 |       "- Develop partnerships with backup suppliers\n",
426 |       "- Consider outsourcing non-critical components\n",
427 |       "\n",
428 |       "Priority 2: Price Pressures\n",
429 |       "Impacts:\n",
430 |       "• Squeezed profit margins\n",
431 |       "• Difficulty maintaining quality standards\n",
432 |       "• Risk of losing customers to lower-cost alternatives\n",
433 |       "\n",
434 |       "Recommended Actions:\n",
435 |       "- Review and optimize cost structure\n",
436 |       "- Negotiate long-term contracts with key customers\n",
437 |       "- Explore automation and efficiency improvements\n",
438 |       "- Develop value-added services to justify pricing\n",
439 |       "\n",
440 |       "Priority 3: Technology Transitions\n",
441 |       "Impacts:\n",
442 |       "• Need for new equipment and processes\n",
443 |       "• Workforce skill gaps\n",
444 |       "• Investment requirements\n",
445 |       "• Risk of obsolescence\n",
446 |       "\n",
447 |       "Recommended Actions:\n",
448 |       "- Create technology roadmap and investment timeline\n",
449 |       "- Implement training programs for workforce\n",
450 |       "- Seek strategic partnerships with tech providers\n",
451 |       "- Consider R&D investments in key areas\n",
452 |       "\n",
453 |       "RISK MITIGATION STRATEGIES\n",
454 |       "\n",
455 |       "Short-term:\n",
456 |       "• Improve communication with customers about constraints\n",
457 |       "• Implement cost control measures\n",
458 |       "• Begin essential technology upgrades\n",
459 |       "\n",
460 |       "Medium-term:\n",
461 |       "• Develop strategic capacity expansion plans\n",
462 |       "• Build relationships with alternative suppliers\n",
463 |       "• Invest in workforce development\n",
464 |       "\n",
465 |       "Long-term:\n",
466 |       "• Transform operations for digital age\n",
467 |       "• Build sustainable competitive advantages\n",
468 |       "• Establish innovation capabilities\n",
469 |       "\n",
470 |       "MONITORING METRICS\n",
471 |       "1. Capacity utilization rates\n",
472 |       "2. Price-to-cost margins\n",
473 |       "3. Technology adoption rates\n",
474 |       "4. Customer satisfaction scores\n",
475 |       "5. Market share trends\n",
476 |       "\n",
477 |       "This analysis should be reviewed quarterly and adjusted based on market conditions.\n"
478 |      ]
479 |     }
480 |    ],
481 |    "source": [
482 |     "# Example 2: Parallelization workflow for stakeholder impact analysis\n",
483 |     "# Process impact analysis for multiple stakeholder groups concurrently\n",
484 |     "\n",
485 |     "stakeholders = [\n",
486 |     "    \"\"\"Customers:\n",
487 |     "    - Price sensitive\n",
488 |     "    - Want better tech\n",
489 |     "    - Environmental concerns\"\"\",\n",
490 |     "    \n",
491 |     "    \"\"\"Employees:\n",
492 |     "    - Job security worries\n",
493 |     "    - Need new skills\n",
494 |     "    - Want clear direction\"\"\",\n",
495 |     "    \n",
496 |     "    \"\"\"Investors:\n",
497 |     "    - Expect growth\n",
498 |     "    - Want cost control\n",
499 |     "    - Risk concerns\"\"\",\n",
500 |     "    \n",
501 |     "    \"\"\"Suppliers:\n",
502 |     "    - Capacity constraints\n",
503 |     "    - Price pressures\n",
504 |     "    - Tech transitions\"\"\"\n",
505 |     "]\n",
506 |     "\n",
507 |     "impact_results = parallel(\n",
508 |     "    \"\"\"Analyze how market changes will impact this stakeholder group.\n",
509 |     "    Provide specific impacts and recommended actions.\n",
510 |     "    Format with clear sections and priorities.\"\"\",\n",
511 |     "    stakeholders\n",
512 |     ")\n",
513 |     "\n",
514 |     "for result in impact_results:\n",
515 |     "    print(result)"
516 |    ]
517 |   },
518 |   {
519 |    "cell_type": "code",
520 |    "execution_count": 6,
521 |    "metadata": {},
522 |    "outputs": [
523 |     {
524 |      "name": "stdout",
525 |      "output_type": "stream",
526 |      "text": [
527 |       "Processing support tickets...\n",
528 |       "\n",
529 |       "\n",
530 |       "Ticket 1:\n",
531 |       "----------------------------------------\n",
532 |       "Subject: Can't access my account\n",
533 |       "    Message: Hi, I've been trying to log in for the past hour but keep getting an 'invalid password' error. \n",
534 |       "    I'm sure I'm using the right password. Can you help me regain access? This is urgent as I need to \n",
535 |       "    submit a report by end of day.\n",
536 |       "    - John\n",
537 |       "\n",
538 |       "Response:\n",
539 |       "----------------------------------------\n",
540 |       "\n",
541 |       "Available routes: ['billing', 'technical', 'account', 'product']\n",
542 |       "Routing Analysis:\n",
543 |       "\n",
544 |       "This issue is clearly related to account access and authentication problems. The user is experiencing login difficulties with their password, which is a core account security and access issue. While there might be technical aspects involved, the primary concern is account access restoration. The urgency expressed by the user and the nature of the problem (password/login issues) makes this a typical account support case. Account team specialists are best equipped to handle password resets, account verification, and access restoration while following proper security protocols.\n",
545 |       "\n",
546 |       "\n",
547 |       "Selected route: account\n",
548 |       "Account Support Response:\n",
549 |       "\n",
550 |       "Dear John,\n",
551 |       "\n",
552 |       "I understand you're experiencing login issues and have an urgent deadline. We'll need to verify your identity before proceeding with account recovery.\n",
553 |       "\n",
554 |       "Immediate Steps to Take:\n",
555 |       "1. Clear your browser cache and cookies\n",
556 |       "2. Ensure CAPS LOCK is not enabled\n",
557 |       "3. Try accessing from a private/incognito window\n",
558 |       "\n",
559 |       "If still unsuccessful, initiate account recovery:\n",
560 |       "1. Visit the secure password reset page: [Reset Portal URL]\n",
561 |       "2. Click \"Forgot Password\"\n",
562 |       "3. Enter your email address\n",
563 |       "4. Follow verification instructions sent to your registered email\n",
564 |       "5. Choose a new strong password\n",
565 |       "\n",
566 |       "SECURITY VERIFICATION REQUIRED:\n",
567 |       "To protect your account, you'll need to provide:\n",
568 |       "- Account email address\n",
569 |       "- Date of last successful login\n",
570 |       "- Any two-factor authentication backup codes (if enabled)\n",
571 |       "\n",
572 |       "⚠️ IMPORTANT SECURITY WARNINGS:\n",
573 |       "- Never share passwords or verification codes\n",
574 |       "- Beware of similar-looking phishing emails\n",
575 |       "- Use unique passwords for each account\n",
576 |       "\n",
577 |       "Expected Resolution Time:\n",
578 |       "- Password reset: 5-10 minutes\n",
579 |       "- Account verification: Up to 1 hour\n",
580 |       "- Support team response: Within 2 hours\n",
581 |       "\n",
582 |       "If you cannot complete these steps or don't receive verification emails, contact our security team at [secure contact information] with your account details.\n",
583 |       "\n",
584 |       "Regards,\n",
585 |       "Account Security Team\n",
586 |       "\n",
587 |       "P.S. Once resolved, we strongly recommend enabling two-factor authentication for additional security.\n",
588 |       "\n",
589 |       "Ticket 2:\n",
590 |       "----------------------------------------\n",
591 |       "Subject: Unexpected charge on my card\n",
592 |       "    Message: Hello, I just noticed a charge of $49.99 on my credit card from your company, but I thought\n",
593 |       "    I was on the $29.99 plan. Can you explain this charge and adjust it if it's a mistake?\n",
594 |       "    Thanks,\n",
595 |       "    Sarah\n",
596 |       "\n",
597 |       "Response:\n",
598 |       "----------------------------------------\n",
599 |       "\n",
600 |       "Available routes: ['billing', 'technical', 'account', 'product']\n",
601 |       "Routing Analysis:\n",
602 |       "\n",
603 |       "This is clearly a billing-related inquiry for several reasons:\n",
604 |       "1. The user is questioning a specific charge amount ($49.99)\n",
605 |       "2. They're comparing it to their expected plan price ($29.99)\n",
606 |       "3. They're requesting explanation of charges and potential adjustment\n",
607 |       "4. The issue involves credit card charges and pricing plans\n",
608 |       "5. There's no mention of technical issues, product features, or account access problems\n",
609 |       "\n",
610 |       "This is a straightforward billing dispute that requires access to payment records and the ability to process refunds or adjustments if needed.\n",
611 |       "\n",
612 |       "\n",
613 |       "Selected route: billing\n",
614 |       "Billing Support Response:\n",
615 |       "\n",
616 |       "Dear Sarah,\n",
617 |       "\n",
618 |       "I understand your concern about the unexpected charge of $49.99 when you were expecting to be billed $29.99.\n",
619 |       "\n",
620 |       "After reviewing the billing details, this difference typically occurs when an account transitions from our Basic plan ($29.99) to our Premium plan, often due to either:\n",
621 |       "- An automatic upgrade based on usage\n",
622 |       "- A plan change request that may have been initiated\n",
623 |       "- The end of a promotional period\n",
624 |       "\n",
625 |       "Here are the next steps to resolve this:\n",
626 |       "\n",
627 |       "1. Within 1 business day: I will conduct a detailed audit of your account history to confirm when and why the plan change occurred\n",
628 |       "2. By tomorrow: You'll receive an email with the complete billing breakdown\n",
629 |       "3. Within 48 hours: If we confirm this was an error, we'll process a refund of $20 (the difference between plans)\n",
630 |       "\n",
631 |       "Payment Options:\n",
632 |       "- If this charge was indeed incorrect, we can either:\n",
633 |       "  * Issue a direct refund to your credit card (3-5 business days)\n",
634 |       "  * Apply a $20 credit to your next billing cycle\n",
635 |       "\n",
636 |       "Please let me know your preferred refund method if we determine this was charged in error.\n",
637 |       "\n",
638 |       "Is there anything else you need clarification on regarding your billing?\n",
639 |       "\n",
640 |       "Best regards,\n",
641 |       "Billing Support Team\n",
642 |       "\n",
643 |       "Ticket 3:\n",
644 |       "----------------------------------------\n",
645 |       "Subject: How to export data?\n",
646 |       "    Message: I need to export all my project data to Excel. I've looked through the docs but can't\n",
647 |       "    figure out how to do a bulk export. Is this possible? If so, could you walk me through the steps?\n",
648 |       "    Best regards,\n",
649 |       "    Mike\n",
650 |       "\n",
651 |       "Response:\n",
652 |       "----------------------------------------\n",
653 |       "\n",
654 |       "Available routes: ['billing', 'technical', 'account', 'product']\n",
655 |       "Routing Analysis:\n",
656 |       "\n",
657 |       "This is clearly a technical/functional question about using a product feature (data export). The user is requesting specific instructions on how to perform a task within the system. Key terms like \"export,\" \"data,\" \"bulk export,\" and the request for step-by-step guidance indicate this is a technical how-to question. This isn't related to billing, account management, or product feedback - it's about understanding how to use an existing feature.\n",
658 |       "\n",
659 |       "\n",
660 |       "Selected route: technical\n",
661 |       "Technical Support Response:\n",
662 |       "\n",
663 |       "I'll help you export your project data to Excel. Here's the step-by-step process:\n",
664 |       "\n",
665 |       "Steps to Export Data:\n",
666 |       "1. Log into your project dashboard\n",
667 |       "2. Navigate to \"Project Settings\" in the top right corner\n",
668 |       "3. Select \"Data Management\" from the dropdown menu\n",
669 |       "4. Click the \"Export\" tab\n",
670 |       "5. Choose \"Bulk Export\" option\n",
671 |       "6. Select data range and specific data fields you want to export\n",
672 |       "7. Choose \"Excel (.xlsx)\" as the export format\n",
673 |       "8. Click \"Generate Export\"\n",
674 |       "9. Wait for the system to process (may take several minutes for large datasets)\n",
675 |       "10. Download the exported file when complete\n",
676 |       "\n",
677 |       "System Requirements:\n",
678 |       "- Supported browsers: Chrome 90+, Firefox 88+, Edge 91+\n",
679 |       "- Minimum 4GB RAM recommended for large exports\n",
680 |       "- Stable internet connection\n",
681 |       "- Excel 2016 or later to open exported files\n",
682 |       "\n",
683 |       "Common Issues & Workarounds:\n",
684 |       "A. If export times out:\n",
685 |       "   - Try reducing the date range\n",
686 |       "   - Export in smaller batches\n",
687 |       "   - Use off-peak hours\n",
688 |       "\n",
689 |       "B. If download fails:\n",
690 |       "   - Clear browser cache\n",
691 |       "   - Use incognito/private mode\n",
692 |       "   - Try a different supported browser\n",
693 |       "\n",
694 |       "Escalation Path:\n",
695 |       "If you continue experiencing issues after trying the above steps, please:\n",
696 |       "1. Contact our technical support team at support@company.com\n",
697 |       "2. Include your project ID and export error messages\n",
698 |       "3. For urgent assistance, call our support hotline: 1-800-TECH-HELP\n"
699 |      ]
700 |     }
701 |    ],
702 |    "source": [
703 |     "# Example 3: Route workflow for customer support ticket handling\n",
704 |     "# Route support tickets to appropriate teams based on content analysis\n",
705 |     "\n",
706 |     "support_routes = {\n",
707 |     "    \"billing\": \"\"\"You are a billing support specialist. Follow these guidelines:\n",
708 |     "    1. Always start with \"Billing Support Response:\"\n",
709 |     "    2. First acknowledge the specific billing issue\n",
710 |     "    3. Explain any charges or discrepancies clearly\n",
711 |     "    4. List concrete next steps with timeline\n",
712 |     "    5. End with payment options if relevant\n",
713 |     "    \n",
714 |     "    Keep responses professional but friendly.\n",
715 |     "    \n",
716 |     "    Input: \"\"\",\n",
717 |     "    \n",
718 |     "    \"technical\": \"\"\"You are a technical support engineer. Follow these guidelines:\n",
719 |     "    1. Always start with \"Technical Support Response:\"\n",
720 |     "    2. List exact steps to resolve the issue\n",
721 |     "    3. Include system requirements if relevant\n",
722 |     "    4. Provide workarounds for common problems\n",
723 |     "    5. End with escalation path if needed\n",
724 |     "    \n",
725 |     "    Use clear, numbered steps and technical details.\n",
726 |     "    \n",
727 |     "    Input: \"\"\",\n",
728 |     "    \n",
729 |     "    \"account\": \"\"\"You are an account security specialist. Follow these guidelines:\n",
730 |     "    1. Always start with \"Account Support Response:\"\n",
731 |     "    2. Prioritize account security and verification\n",
732 |     "    3. Provide clear steps for account recovery/changes\n",
733 |     "    4. Include security tips and warnings\n",
734 |     "    5. Set clear expectations for resolution time\n",
735 |     "    \n",
736 |     "    Maintain a serious, security-focused tone.\n",
737 |     "    \n",
738 |     "    Input: \"\"\",\n",
739 |     "    \n",
740 |     "    \"product\": \"\"\"You are a product specialist. Follow these guidelines:\n",
741 |     "    1. Always start with \"Product Support Response:\"\n",
742 |     "    2. Focus on feature education and best practices\n",
743 |     "    3. Include specific examples of usage\n",
744 |     "    4. Link to relevant documentation sections\n",
745 |     "    5. Suggest related features that might help\n",
746 |     "    \n",
747 |     "    Be educational and encouraging in tone.\n",
748 |     "    \n",
749 |     "    Input: \"\"\"\n",
750 |     "}\n",
751 |     "\n",
752 |     "# Test with different support tickets\n",
753 |     "tickets = [\n",
754 |     "    \"\"\"Subject: Can't access my account\n",
755 |     "    Message: Hi, I've been trying to log in for the past hour but keep getting an 'invalid password' error. \n",
756 |     "    I'm sure I'm using the right password. Can you help me regain access? This is urgent as I need to \n",
757 |     "    submit a report by end of day.\n",
758 |     "    - John\"\"\",\n",
759 |     "    \n",
760 |     "    \"\"\"Subject: Unexpected charge on my card\n",
761 |     "    Message: Hello, I just noticed a charge of $49.99 on my credit card from your company, but I thought\n",
762 |     "    I was on the $29.99 plan. Can you explain this charge and adjust it if it's a mistake?\n",
763 |     "    Thanks,\n",
764 |     "    Sarah\"\"\",\n",
765 |     "    \n",
766 |     "    \"\"\"Subject: How to export data?\n",
767 |     "    Message: I need to export all my project data to Excel. I've looked through the docs but can't\n",
768 |     "    figure out how to do a bulk export. Is this possible? If so, could you walk me through the steps?\n",
769 |     "    Best regards,\n",
770 |     "    Mike\"\"\"\n",
771 |     "]\n",
772 |     "\n",
773 |     "print(\"Processing support tickets...\\n\")\n",
774 |     "for i, ticket in enumerate(tickets, 1):\n",
775 |     "    print(f\"\\nTicket {i}:\")\n",
776 |     "    print(\"-\" * 40)\n",
777 |     "    print(ticket)\n",
778 |     "    print(\"\\nResponse:\")\n",
779 |     "    print(\"-\" * 40)\n",
780 |     "    response = route(ticket, support_routes)\n",
781 |     "    print(response)"
782 |    ]
783 |   }
784 |  ],
785 |  "metadata": {
786 |   "kernelspec": {
787 |    "display_name": "py311",
788 |    "language": "python",
789 |    "name": "python3"
790 |   },
791 |   "language_info": {
792 |    "codemirror_mode": {
793 |     "name": "ipython",
794 |     "version": 3
795 |    },
796 |    "file_extension": ".py",
797 |    "mimetype": "text/x-python",
798 |    "name": "python",
799 |    "nbconvert_exporter": "python",
800 |    "pygments_lexer": "ipython3",
801 |    "version": "3.11.6"
802 |   }
803 |  },
804 |  "nbformat": 4,
805 |  "nbformat_minor": 2
806 | }
807 | 


--------------------------------------------------------------------------------
/patterns/agents/evaluator_optimizer.ipynb:
--------------------------------------------------------------------------------
  1 | {
  2 |  "cells": [
  3 |   {
  4 |    "cell_type": "markdown",
  5 |    "metadata": {},
  6 |    "source": [
  7 |     "## Evaluator-Optimizer Workflow\n",
  8 |     "In this workflow, one LLM call generates a response while another provides evaluation and feedback in a loop.\n",
  9 |     "\n",
 10 |     "### When to use this workflow\n",
 11 |     "This workflow is particularly effective when we have:\n",
 12 |     "\n",
 13 |     "- Clear evaluation criteria\n",
 14 |     "- Value from iterative refinement\n",
 15 |     "\n",
 16 |     "The two signs of good fit are:\n",
 17 |     "\n",
 18 |     "- LLM responses can be demonstrably improved when feedback is provided\n",
 19 |     "- The LLM can provide meaningful feedback itself"
 20 |    ]
 21 |   },
 22 |   {
 23 |    "cell_type": "code",
 24 |    "execution_count": 1,
 25 |    "metadata": {},
 26 |    "outputs": [],
 27 |    "source": [
 28 |     "from util import llm_call, extract_xml\n",
 29 |     "\n",
 30 |     "def generate(prompt: str, task: str, context: str = \"\") -> tuple[str, str]:\n",
 31 |     "    \"\"\"Generate and improve a solution based on feedback.\"\"\"\n",
 32 |     "    full_prompt = f\"{prompt}\\n{context}\\nTask: {task}\" if context else f\"{prompt}\\nTask: {task}\"\n",
 33 |     "    response = llm_call(full_prompt)\n",
 34 |     "    thoughts = extract_xml(response, \"thoughts\")\n",
 35 |     "    result = extract_xml(response, \"response\")\n",
 36 |     "    \n",
 37 |     "    print(\"\\n=== GENERATION START ===\")\n",
 38 |     "    print(f\"Thoughts:\\n{thoughts}\\n\")\n",
 39 |     "    print(f\"Generated:\\n{result}\")\n",
 40 |     "    print(\"=== GENERATION END ===\\n\")\n",
 41 |     "    \n",
 42 |     "    return thoughts, result\n",
 43 |     "\n",
 44 |     "def evaluate(prompt: str, content: str, task: str) -> tuple[str, str]:\n",
 45 |     "    \"\"\"Evaluate if a solution meets requirements.\"\"\"\n",
 46 |     "    full_prompt = f\"{prompt}\\nOriginal task: {task}\\nContent to evaluate: {content}\"\n",
 47 |     "    response = llm_call(full_prompt)\n",
 48 |     "    evaluation = extract_xml(response, \"evaluation\")\n",
 49 |     "    feedback = extract_xml(response, \"feedback\")\n",
 50 |     "    \n",
 51 |     "    print(\"=== EVALUATION START ===\")\n",
 52 |     "    print(f\"Status: {evaluation}\")\n",
 53 |     "    print(f\"Feedback: {feedback}\")\n",
 54 |     "    print(\"=== EVALUATION END ===\\n\")\n",
 55 |     "    \n",
 56 |     "    return evaluation, feedback\n",
 57 |     "\n",
 58 |     "def loop(task: str, evaluator_prompt: str, generator_prompt: str) -> tuple[str, list[dict]]:\n",
 59 |     "    \"\"\"Keep generating and evaluating until requirements are met.\"\"\"\n",
 60 |     "    memory = []\n",
 61 |     "    chain_of_thought = []\n",
 62 |     "    \n",
 63 |     "    thoughts, result = generate(generator_prompt, task)\n",
 64 |     "    memory.append(result)\n",
 65 |     "    chain_of_thought.append({\"thoughts\": thoughts, \"result\": result})\n",
 66 |     "    \n",
 67 |     "    while True:\n",
 68 |     "        evaluation, feedback = evaluate(evaluator_prompt, result, task)\n",
 69 |     "        if evaluation == \"PASS\":\n",
 70 |     "            return result, chain_of_thought\n",
 71 |     "            \n",
 72 |     "        context = \"\\n\".join([\n",
 73 |     "            \"Previous attempts:\",\n",
 74 |     "            *[f\"- {m}\" for m in memory],\n",
 75 |     "            f\"\\nFeedback: {feedback}\"\n",
 76 |     "        ])\n",
 77 |     "        \n",
 78 |     "        thoughts, result = generate(generator_prompt, task, context)\n",
 79 |     "        memory.append(result)\n",
 80 |     "        chain_of_thought.append({\"thoughts\": thoughts, \"result\": result})"
 81 |    ]
 82 |   },
 83 |   {
 84 |    "cell_type": "markdown",
 85 |    "metadata": {},
 86 |    "source": [
 87 |     "### Example Use Case: Iterative coding loop\n",
 88 |     "\n"
 89 |    ]
 90 |   },
 91 |   {
 92 |    "cell_type": "code",
 93 |    "execution_count": null,
 94 |    "metadata": {},
 95 |    "outputs": [
 96 |     {
 97 |      "name": "stdout",
 98 |      "output_type": "stream",
 99 |      "text": [
100 |       "\n",
101 |       "=== GENERATION START ===\n",
102 |       "Thoughts:\n",
103 |       "\n",
104 |       "The task requires implementing a Stack with constant time operations including finding minimum. \n",
105 |       "To achieve O(1) for getMin(), we need to maintain a second stack that keeps track of minimums.\n",
106 |       "Each time we push, if the value is smaller than current min, we add it to minStack.\n",
107 |       "When we pop, if the popped value equals current min, we also pop from minStack.\n",
108 |       "\n",
109 |       "\n",
110 |       "Generated:\n",
111 |       "\n",
112 |       "
python\n",
113 |       "class MinStack:\n",
114 |       "    def __init__(self):\n",
115 |       "        self.stack = []\n",
116 |       "        self.minStack = []\n",
117 |       "        \n",
118 |       "    def push(self, x: int) -> None:\n",
119 |       "        self.stack.append(x)\n",
120 |       "        if not self.minStack or x <= self.minStack[-1]:\n",
121 |       "            self.minStack.append(x)\n",
122 |       "            \n",
123 |       "    def pop(self) -> None:\n",
124 |       "        if not self.stack:\n",
125 |       "            return\n",
126 |       "        if self.stack[-1] == self.minStack[-1]:\n",
127 |       "            self.minStack.pop()\n",
128 |       "        self.stack.pop()\n",
129 |       "        \n",
130 |       "    def getMin(self) -> int:\n",
131 |       "        if not self.minStack:\n",
132 |       "            return None\n",
133 |       "        return self.minStack[-1]\n",
134 |       "
\n",
135 |       "\n",
136 |       "=== GENERATION END ===\n",
137 |       "\n",
138 |       "=== EVALUATION START ===\n",
139 |       "Status: NEEDS_IMPROVEMENT\n",
140 |       "Feedback: \n",
141 |       "While the implementation is generally correct and achieves O(1) time complexity for all operations, there are several areas for improvement:\n",
142 |       "\n",
143 |       "1. Error Handling:\n",
144 |       "- pop() should raise an exception when stack is empty rather than silently returning\n",
145 |       "- getMin() should raise an exception when stack is empty rather than returning None\n",
146 |       "- These behaviors should be consistent with standard stack implementations\n",
147 |       "\n",
148 |       "2. Type Hints:\n",
149 |       "- Return type hint for pop() should be None or void\n",
150 |       "- Missing type hints for class variables stack and minStack\n",
151 |       "\n",
152 |       "3. Documentation:\n",
153 |       "- Missing docstrings for class and methods\n",
154 |       "- Missing parameter descriptions\n",
155 |       "\n",
156 |       "4. Edge Cases:\n",
157 |       "- No explicit handling of invalid input types for push()\n",
158 |       "\n",
159 |       "The core algorithm is correct and efficient, but the implementation could be more robust and better documented for production use.\n",
160 |       "\n",
161 |       "=== EVALUATION END ===\n",
162 |       "\n",
163 |       "\n",
164 |       "=== GENERATION START ===\n",
165 |       "Thoughts:\n",
166 |       "\n",
167 |       "Based on the feedback, I'll improve the implementation by:\n",
168 |       "1. Adding proper error handling with exceptions\n",
169 |       "2. Including type hints and docstrings\n",
170 |       "3. Adding input validation\n",
171 |       "4. Maintaining O(1) time complexity for all operations\n",
172 |       "\n",
173 |       "\n",
174 |       "Generated:\n",
175 |       "\n",
176 |       "
python\n",
177 |       "from typing import List\n",
178 |       "\n",
179 |       "class MinStack:\n",
180 |       "    \"\"\"A stack that supports push, pop, and getting minimum element in O(1) time.\"\"\"\n",
181 |       "    \n",
182 |       "    def __init__(self):\n",
183 |       "        \"\"\"Initialize empty stack with two internal lists.\"\"\"\n",
184 |       "        self.stack: List[int] = []\n",
185 |       "        self.minStack: List[int] = []\n",
186 |       "        \n",
187 |       "    def push(self, x: int) -> None:\n",
188 |       "        \"\"\"\n",
189 |       "        Push element onto stack and update minimum stack.\n",
190 |       "        \n",
191 |       "        Args:\n",
192 |       "            x: Integer to push onto stack\n",
193 |       "            \n",
194 |       "        Raises:\n",
195 |       "            TypeError: If x is not an integer\n",
196 |       "        \"\"\"\n",
197 |       "        if not isinstance(x, int):\n",
198 |       "            raise TypeError(\"Input must be an integer\")\n",
199 |       "            \n",
200 |       "        self.stack.append(x)\n",
201 |       "        if not self.minStack or x <= self.minStack[-1]:\n",
202 |       "            self.minStack.append(x)\n",
203 |       "            \n",
204 |       "    def pop(self) -> None:\n",
205 |       "        \"\"\"\n",
206 |       "        Remove and return top element from stack.\n",
207 |       "        \n",
208 |       "        Raises:\n",
209 |       "            IndexError: If stack is empty\n",
210 |       "        \"\"\"\n",
211 |       "        if not self.stack:\n",
212 |       "            raise IndexError(\"Cannot pop from empty stack\")\n",
213 |       "            \n",
214 |       "        if self.stack[-1] == self.minStack[-1]:\n",
215 |       "            self.minStack.pop()\n",
216 |       "        self.stack.pop()\n",
217 |       "        \n",
218 |       "    def getMin(self) -> int:\n",
219 |       "        \"\"\"\n",
220 |       "        Get minimum element in stack.\n",
221 |       "        \n",
222 |       "        Returns:\n",
223 |       "            int: Minimum element in stack\n",
224 |       "            \n",
225 |       "        Raises:\n",
226 |       "            IndexError: If stack is empty\n",
227 |       "        \"\"\"\n",
228 |       "        if not self.minStack:\n",
229 |       "            raise IndexError(\"Cannot get minimum from empty stack\")\n",
230 |       "        return self.minStack[-1]\n",
231 |       "
\n",
232 |       "\n",
233 |       "=== GENERATION END ===\n",
234 |       "\n"
235 |      ]
236 |     }
237 |    ],
238 |    "source": [
239 |     "evaluator_prompt = \"\"\"\n",
240 |     "Evaluate this following code implementation for:\n",
241 |     "1. code correctness\n",
242 |     "2. time complexity\n",
243 |     "3. style and best practices\n",
244 |     "\n",
245 |     "You should be evaluating only and not attemping to solve the task.\n",
246 |     "Only output \"PASS\" if all criteria are met and you have no further suggestions for improvements.\n",
247 |     "Output your evaluation concisely in the following format.\n",
248 |     "\n",
249 |     "<evaluation>PASS, NEEDS_IMPROVEMENT, or FAIL</evaluation>\n",
250 |     "<feedback>\n",
251 |     "What needs improvement and why.\n",
252 |     "</feedback>\n",
253 |     "\"\"\"\n",
254 |     "\n",
255 |     "generator_prompt = \"\"\"\n",
256 |     "Your goal is to complete the task based on <user input>. If there are feedback \n",
257 |     "from your previous generations, you should reflect on them to improve your solution\n",
258 |     "\n",
259 |     "Output your answer concisely in the following format: \n",
260 |     "\n",
261 |     "<thoughts>\n",
262 |     "[Your understanding of the task and feedback and how you plan to improve]\n",
263 |     "</thoughts>\n",
264 |     "\n",
265 |     "<response>\n",
266 |     "[Your code implementation here]\n",
267 |     "</response>\n",
268 |     "\"\"\"\n",
269 |     "\n",
270 |     "task = \"\"\"\n",
271 |     "<user input>\n",
272 |     "Implement a Stack with:\n",
273 |     "1. push(x)\n",
274 |     "2. pop()\n",
275 |     "3. getMin()\n",
276 |     "All operations should be O(1).\n",
277 |     "</user input>\n",
278 |     "\"\"\"\n",
279 |     "\n",
280 |     "loop(task, evaluator_prompt, generator_prompt)\n"
281 |    ]
282 |   }
283 |  ],
284 |  "metadata": {
285 |   "kernelspec": {
286 |    "display_name": "py311",
287 |    "language": "python",
288 |    "name": "python3"
289 |   },
290 |   "language_info": {
291 |    "codemirror_mode": {
292 |     "name": "ipython",
293 |     "version": 3
294 |    },
295 |    "file_extension": ".py",
296 |    "mimetype": "text/x-python",
297 |    "name": "python",
298 |    "nbconvert_exporter": "python",
299 |    "pygments_lexer": "ipython3",
300 |    "version": "3.11.6"
301 |   }
302 |  },
303 |  "nbformat": 4,
304 |  "nbformat_minor": 2
305 | }
306 | 


--------------------------------------------------------------------------------
/patterns/agents/orchestrator_workers.ipynb:
--------------------------------------------------------------------------------
  1 | {
  2 |  "cells": [
  3 |   {
  4 |    "cell_type": "markdown",
  5 |    "metadata": {},
  6 |    "source": [
  7 |     "## Orchestrator-Workers Workflow\n",
  8 |     "In this workflow, a central LLM dynamically breaks down tasks, delegates them to worker LLMs, and synthesizes their results.\n",
  9 |     "\n",
 10 |     "### When to use this workflow\n",
 11 |     "This workflow is well-suited for complex tasks where you can't predict the subtasks needed. The key difference from simple parallelization is its flexibility—subtasks aren't pre-defined, but determined by the orchestrator based on the specific input."
 12 |    ]
 13 |   },
 14 |   {
 15 |    "cell_type": "code",
 16 |    "execution_count": 1,
 17 |    "metadata": {},
 18 |    "outputs": [],
 19 |    "source": [
 20 |     "from typing import Dict, List, Optional\n",
 21 |     "from util import llm_call, extract_xml\n",
 22 |     "\n",
 23 |     "def parse_tasks(tasks_xml: str) -> List[Dict]:\n",
 24 |     "    \"\"\"Parse XML tasks into a list of task dictionaries.\"\"\"\n",
 25 |     "    tasks = []\n",
 26 |     "    current_task = {}\n",
 27 |     "    \n",
 28 |     "    for line in tasks_xml.split('\\n'):\n",
 29 |     "        line = line.strip()\n",
 30 |     "        if not line:\n",
 31 |     "            continue\n",
 32 |     "            \n",
 33 |     "        if line.startswith(\"<task>\"):\n",
 34 |     "            current_task = {}\n",
 35 |     "        elif line.startswith(\"<type>\"):\n",
 36 |     "            current_task[\"type\"] = line[6:-7].strip()\n",
 37 |     "        elif line.startswith(\"<description>\"):\n",
 38 |     "            current_task[\"description\"] = line[12:-13].strip()\n",
 39 |     "        elif line.startswith(\"</task>\"):\n",
 40 |     "            if \"description\" in current_task:\n",
 41 |     "                if \"type\" not in current_task:\n",
 42 |     "                    current_task[\"type\"] = \"default\"\n",
 43 |     "                tasks.append(current_task)\n",
 44 |     "    \n",
 45 |     "    return tasks\n",
 46 |     "\n",
 47 |     "class FlexibleOrchestrator:\n",
 48 |     "    \"\"\"Break down tasks and run them in parallel using worker LLMs.\"\"\"\n",
 49 |     "    \n",
 50 |     "    def __init__(\n",
 51 |     "        self,\n",
 52 |     "        orchestrator_prompt: str,\n",
 53 |     "        worker_prompt: str,\n",
 54 |     "    ):\n",
 55 |     "        \"\"\"Initialize with prompt templates.\"\"\"\n",
 56 |     "        self.orchestrator_prompt = orchestrator_prompt\n",
 57 |     "        self.worker_prompt = worker_prompt\n",
 58 |     "\n",
 59 |     "    def _format_prompt(self, template: str, **kwargs) -> str:\n",
 60 |     "        \"\"\"Format a prompt template with variables.\"\"\"\n",
 61 |     "        try:\n",
 62 |     "            return template.format(**kwargs)\n",
 63 |     "        except KeyError as e:\n",
 64 |     "            raise ValueError(f\"Missing required prompt variable: {e}\")\n",
 65 |     "\n",
 66 |     "    def process(self, task: str, context: Optional[Dict] = None) -> Dict:\n",
 67 |     "        \"\"\"Process task by breaking it down and running subtasks in parallel.\"\"\"\n",
 68 |     "        context = context or {}\n",
 69 |     "        \n",
 70 |     "        # Step 1: Get orchestrator response\n",
 71 |     "        orchestrator_input = self._format_prompt(\n",
 72 |     "            self.orchestrator_prompt,\n",
 73 |     "            task=task,\n",
 74 |     "            **context\n",
 75 |     "        )\n",
 76 |     "        orchestrator_response = llm_call(orchestrator_input)\n",
 77 |     "        \n",
 78 |     "        # Parse orchestrator response\n",
 79 |     "        analysis = extract_xml(orchestrator_response, \"analysis\")\n",
 80 |     "        tasks_xml = extract_xml(orchestrator_response, \"tasks\")\n",
 81 |     "        tasks = parse_tasks(tasks_xml)\n",
 82 |     "        \n",
 83 |     "        print(\"\\n=== ORCHESTRATOR OUTPUT ===\")\n",
 84 |     "        print(f\"\\nANALYSIS:\\n{analysis}\")\n",
 85 |     "        print(f\"\\nTASKS:\\n{tasks}\")\n",
 86 |     "        \n",
 87 |     "        # Step 2: Process each task\n",
 88 |     "        worker_results = []\n",
 89 |     "        for task_info in tasks:\n",
 90 |     "            worker_input = self._format_prompt(\n",
 91 |     "                self.worker_prompt,\n",
 92 |     "                original_task=task,\n",
 93 |     "                task_type=task_info['type'],\n",
 94 |     "                task_description=task_info['description'],\n",
 95 |     "                **context\n",
 96 |     "            )\n",
 97 |     "            \n",
 98 |     "            worker_response = llm_call(worker_input)\n",
 99 |     "            result = extract_xml(worker_response, \"response\")\n",
100 |     "            \n",
101 |     "            worker_results.append({\n",
102 |     "                \"type\": task_info[\"type\"],\n",
103 |     "                \"description\": task_info[\"description\"],\n",
104 |     "                \"result\": result\n",
105 |     "            })\n",
106 |     "            \n",
107 |     "            print(f\"\\n=== WORKER RESULT ({task_info['type']}) ===\\n{result}\\n\")\n",
108 |     "        \n",
109 |     "        return {\n",
110 |     "            \"analysis\": analysis,\n",
111 |     "            \"worker_results\": worker_results,\n",
112 |     "        }\n"
113 |    ]
114 |   },
115 |   {
116 |    "cell_type": "markdown",
117 |    "metadata": {},
118 |    "source": [
119 |     "### Example Use Case: Marketing Variation Generation\n",
120 |     "\n"
121 |    ]
122 |   },
123 |   {
124 |    "cell_type": "code",
125 |    "execution_count": 2,
126 |    "metadata": {},
127 |    "outputs": [
128 |     {
129 |      "name": "stdout",
130 |      "output_type": "stream",
131 |      "text": [
132 |       "\n",
133 |       "=== ORCHESTRATOR OUTPUT ===\n",
134 |       "\n",
135 |       "ANALYSIS:\n",
136 |       "\n",
137 |       "This task requires creating marketing copy for an eco-friendly water bottle, which presents multiple angles for effective communication. The key challenge is balancing environmental benefits with practical features while maintaining appeal to different consumer segments.\n",
138 |       "\n",
139 |       "Key variations would be valuable because:\n",
140 |       "1. Technical buyers need specific details about materials and environmental impact\n",
141 |       "2. Lifestyle-focused consumers respond better to emotional benefits and storytelling\n",
142 |       "3. Different tones can target distinct market segments while promoting the same core product\n",
143 |       "\n",
144 |       "The technical approach serves those who make purchase decisions based on specifications and measurable impact, while the conversational approach connects with those who buy based on lifestyle alignment and emotional resonance.\n",
145 |       "\n",
146 |       "\n",
147 |       "TASKS:\n",
148 |       "[{'type': 'formal', 'description': '>Create a specification-focused description highlighting material composition, environmental certifications, capacity measurements, and quantifiable eco-impact (e.g., \"plastic bottles saved per year\"). Include technical details about manufacturing process and recycling capabilities.<'}, {'type': 'conversational', 'description': '>Develop a narrative-style description that focuses on the user experience, lifestyle benefits, and emotional connection to environmental protection. Use relatable scenarios and casual language to help readers envision the bottle as part of their daily routine.<'}, {'type': 'hybrid', 'description': '>Combine emotional appeal with key specifications by weaving technical details into a story-driven format. Balance environmental impact statistics with aspirational messaging about sustainability lifestyle choices.<'}]\n",
149 |       "\n",
150 |       "=== WORKER RESULT (formal) ===\n",
151 |       "\n",
152 |       "Introducing the EcoVessel Pro Series: A precision-engineered hydration solution crafted from 100% post-consumer recycled stainless steel, certified by the Global Recycled Standard (GRS).\n",
153 |       "\n",
154 |       "Technical Specifications:\n",
155 |       "• Capacity: 750ml / 25.4 fl oz\n",
156 |       "• Material: 18/8 food-grade recycled stainless steel (304 grade)\n",
157 |       "• Wall thickness: 2mm double-wall vacuum insulation\n",
158 |       "• Temperature retention: 24 hours cold / 12 hours hot\n",
159 |       "• Weight: 340g / 12 oz (empty)\n",
160 |       "\n",
161 |       "Environmental Certifications:\n",
162 |       "• Carbon Neutral Product certified by Climate Partner\n",
163 |       "• BPA-free verification from NSF International\n",
164 |       "• ISO 14001 Environmental Management certification\n",
165 |       "\n",
166 |       "Manufacturing Process:\n",
167 |       "Manufactured using hydroelectric power in our carbon-neutral facility, each vessel undergoes a proprietary eco-sanitization process utilizing steam-based sterilization, eliminating chemical cleaning agents. The powder coating is applied through a zero-waste electrostatic process.\n",
168 |       "\n",
169 |       "Environmental Impact Metrics:\n",
170 |       "• Eliminates approximately 167 single-use plastic bottles annually per user\n",
171 |       "• 87% lower carbon footprint compared to traditional bottle manufacturing\n",
172 |       "• 100% recyclable at end-of-life through our closed-loop recycling program\n",
173 |       "• Saves 2,920 liters of water annually through eliminated plastic bottle production\n",
174 |       "\n",
175 |       "Each unit includes a digital tracking code for real-time impact monitoring and verification of authenticity. Engineered for a minimum 10-year service life under normal usage conditions.\n",
176 |       "\n",
177 |       "\n",
178 |       "\n",
179 |       "=== WORKER RESULT (conversational) ===\n",
180 |       "\n",
181 |       "\n",
182 |       "\n",
183 |       "=== WORKER RESULT (hybrid) ===\n",
184 |       "\n",
185 |       "Meet the AquaVerde Elite - where your daily hydration ritual becomes a powerful statement for our planet's future.\n",
186 |       "\n",
187 |       "Imagine starting your day knowing that every sip you take helps prevent up to 167 single-use plastic bottles from entering our oceans annually. The AquaVerde Elite isn't just a water bottle; it's your personal ambassador in the fight against plastic pollution, crafted from aerospace-grade recycled stainless steel that's been given a second life.\n",
188 |       "\n",
189 |       "Built to accompany you through life's adventures, this 24oz companion features our innovative ThermaLock™ technology, maintaining your cold drinks frosty for 24 hours or your hot beverages steaming for 12 hours. The double-wall vacuum insulation isn't just about performance - it's engineered to use 30% less material than conventional designs while delivering superior temperature retention.\n",
190 |       "\n",
191 |       "The bottle's sleek silhouette houses thoughtful details that enhance your daily experience: a leak-proof AutoSeal cap that operates with one hand, a built-in carrying loop made from recycled climbing rope, and our signature CloudTouch™ exterior finish that's both grippy and gorgeous. Available in four nature-inspired colors (Ocean Deep, Forest Canopy, Desert Dawn, and Mountain Mist), each bottle's finish is created using a water-based, zero-VOC coating process.\n",
192 |       "\n",
193 |       "But perhaps the most beautiful feature is what you don't see - every AquaVerde Elite helps fund clean water projects in developing communities, with 2% of each purchase supporting water conservation initiatives worldwide. Your choice to carry the AquaVerde Elite isn't just about staying hydrated; it's about being part of a global movement toward a more sustainable future.\n",
194 |       "\n",
195 |       "Specifications that matter:\n",
196 |       "• Capacity: 24oz/710ml\n",
197 |       "• Weight: 12.8oz\n",
198 |       "• Materials: 90% recycled 18/8 stainless steel\n",
199 |       "• BPA-free, phthalate-free\n",
200 |       "• Dishwasher safe\n",
201 |       "• Lifetime warranty\n",
202 |       "\n",
203 |       "Join the growing community of AquaVerde carriers who've collectively prevented over 2 million single-use bottles from entering our ecosystems. Because every drop counts, and every choice matters.\n",
204 |       "\n",
205 |       "\n"
206 |      ]
207 |     }
208 |    ],
209 |    "source": [
210 |     "ORCHESTRATOR_PROMPT = \"\"\"\n",
211 |     "Analyze this task and break it down into 2-3 distinct approaches:\n",
212 |     "\n",
213 |     "Task: {task}\n",
214 |     "\n",
215 |     "Return your response in this format:\n",
216 |     "\n",
217 |     "<analysis>\n",
218 |     "Explain your understanding of the task and which variations would be valuable.\n",
219 |     "Focus on how each approach serves different aspects of the task.\n",
220 |     "</analysis>\n",
221 |     "\n",
222 |     "<tasks>\n",
223 |     "    <task>\n",
224 |     "    <type>formal</type>\n",
225 |     "    <description>Write a precise, technical version that emphasizes specifications</description>\n",
226 |     "    </task>\n",
227 |     "    <task>\n",
228 |     "    <type>conversational</type>\n",
229 |     "    <description>Write an engaging, friendly version that connects with readers</description>\n",
230 |     "    </task>\n",
231 |     "</tasks>\n",
232 |     "\"\"\"\n",
233 |     "\n",
234 |     "WORKER_PROMPT = \"\"\"\n",
235 |     "Generate content based on:\n",
236 |     "Task: {original_task}\n",
237 |     "Style: {task_type}\n",
238 |     "Guidelines: {task_description}\n",
239 |     "\n",
240 |     "Return your response in this format:\n",
241 |     "\n",
242 |     "<response>\n",
243 |     "Your content here, maintaining the specified style and fully addressing requirements.\n",
244 |     "</response>\n",
245 |     "\"\"\"\n",
246 |     "\n",
247 |     "\n",
248 |     "orchestrator = FlexibleOrchestrator(\n",
249 |     "    orchestrator_prompt=ORCHESTRATOR_PROMPT,\n",
250 |     "    worker_prompt=WORKER_PROMPT,\n",
251 |     ")\n",
252 |     "\n",
253 |     "results = orchestrator.process(\n",
254 |     "    task=\"Write a product description for a new eco-friendly water bottle\",\n",
255 |     "    context={\n",
256 |     "        \"target_audience\": \"environmentally conscious millennials\",\n",
257 |     "        \"key_features\": [\"plastic-free\", \"insulated\", \"lifetime warranty\"]\n",
258 |     "    }\n",
259 |     ")"
260 |    ]
261 |   }
262 |  ],
263 |  "metadata": {
264 |   "kernelspec": {
265 |    "display_name": "py311",
266 |    "language": "python",
267 |    "name": "python3"
268 |   },
269 |   "language_info": {
270 |    "codemirror_mode": {
271 |     "name": "ipython",
272 |     "version": 3
273 |    },
274 |    "file_extension": ".py",
275 |    "mimetype": "text/x-python",
276 |    "name": "python",
277 |    "nbconvert_exporter": "python",
278 |    "pygments_lexer": "ipython3",
279 |    "version": "3.11.6"
280 |   }
281 |  },
282 |  "nbformat": 4,
283 |  "nbformat_minor": 2
284 | }
285 | 


--------------------------------------------------------------------------------
/patterns/agents/util.py:
--------------------------------------------------------------------------------
 1 | from anthropic import Anthropic
 2 | import os
 3 | import re
 4 | 
 5 | client = Anthropic(api_key=os.environ["ANTHROPIC_API_KEY"])
 6 | 
 7 | def llm_call(prompt: str, system_prompt: str = "", model="claude-3-5-sonnet-20241022") -> str:
 8 |     """
 9 |     Calls the model with the given prompt and returns the response.
10 | 
11 |     Args:
12 |         prompt (str): The user prompt to send to the model.
13 |         system_prompt (str, optional): The system prompt to send to the model. Defaults to "".
14 |         model (str, optional): The model to use for the call. Defaults to "claude-3-5-sonnet-20241022".
15 | 
16 |     Returns:
17 |         str: The response from the language model.
18 |     """
19 |     client = Anthropic(api_key=os.environ["ANTHROPIC_API_KEY"])
20 |     messages = [{"role": "user", "content": prompt}]
21 |     response = client.messages.create(
22 |         model=model,
23 |         max_tokens=4096,
24 |         system=system_prompt,
25 |         messages=messages,
26 |         temperature=0.1,
27 |     )
28 |     return response.content[0].text
29 | 
30 | def extract_xml(text: str, tag: str) -> str:
31 |     """
32 |     Extracts the content of the specified XML tag from the given text. Used for parsing structured responses 
33 | 
34 |     Args:
35 |         text (str): The text containing the XML.
36 |         tag (str): The XML tag to extract content from.
37 | 
38 |     Returns:
39 |         str: The content of the specified XML tag, or an empty string if the tag is not found.
40 |     """
41 |     match = re.search(f'<{tag}>(.*?)</{tag}>', text, re.DOTALL)
42 |     return match.group(1) if match else ""


Remember what I stated above this must be complete and accurate solely based on the code base I just provided you. Not on your knowledge. Remember this must be complete and accurate and I'm going to emphasize this again for emphasis complete and accurate only based on the code base I provided above. It must be complete and accurate as if it were gonna be audited for such you are going to learn it and provide in depth examples as well after you create the in depth documentation step by step guide ranging from the most sought after intelligent software developer to a no coder who's just starting with AI make it complete and accurate begin. Be intelligent in this process. Think about my needs. Become me and my persona. Take on different perspectives in multiple views and then go back to you and document, then take on my perspective based on what I've told you. You can see my point of view. You are able to understand what I want based on everything I said. You can see these perspectives. You can evaluate multiple different things that I cannot. Thus, you can create this documentation amazingly and robust, begin. 

There are no shortcuts in this task, and don't be lazy. Literally none. It is all or nothing on the complete and functional documentation. Also provide a simple, complete, and functional chatbot for the users to copy and paste and use. Literally copy and paste. No other option. The chatbot must be complete, functional, and accurate solely based on this documentation. Remember, don't be lazy. You can take as long as you can. Act as if you are hired to do this, and you will lose your job if you do not do it completely accurately in all ways as I stated. Do not disappoint me. 
